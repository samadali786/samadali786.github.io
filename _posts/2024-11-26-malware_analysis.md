---

title: "How to Perform Static and Dynamic Malware Analysis"
date: "2024-11-26 00:00:00"
categories: [Malware Analysis, Malware Static and Dynamic Analysis Project]
tags: [Malware Analysis]

---

# Overview

Malware Analysis is the process to understand the behavior, purpose, and the potential impact of the malware, it also involves analyzing malware code, malware process, it's origin, types, and delivery methods. there are two main types of malware analysis which we are going Static and Dynamic malware analysis in this project we understand what is Static and Dynamic malware analysis and how to perform these analysis.

# Static Malware Analysis

In Static Malware Analysis we examine the malware without running or executing. It include analyzing code, structure, format, and verifying hashes. It is the very first and safe step to perform malware analysis, because in this step we analyzing the malware without executing it. It is still a good practice to perform static malware analysis in a sandboxing or isolated environment. there are many tools that are currently used by SOC and Security Analysts to perform Static Malware analysis some of the important tool are.

# Tools to perform Static Malware Analysis

1. HexEditor.  
2. HashMyFiles.
3. VirusTotal.
4. CFF Explorer.
5. Pestudio.


# Dynamic Malware Analysis

In Dynamic Malware Analysis we examine the malware by running or executing it to get more in-depth understanding of malware. It include observing malware behavior, process, capacity, and potential impact. we always have to perfrom Dynamic malware analysis in the isolated secure sandbox environment. It is also challenging and could also take more time to perform depending on how malicious the malware is. there are many tools that are currently used by SOC and Security Analysts to perform Dynamic Malware analysis some of the important tool are.

# Tools to perform Dynamic Malware Analysis

1. Procmon (Process monitor).
2. Nmap.
3. ILSpy.
4. Regshot.
5. Wireshark.
6. Ghidra (reverse engineering tool for dynamic analysis).

# Steps to perform Static Malware Analysis

First to perfrom the static malware analysis we need to download the malware sample. In this example I use 
[MalwareBazaar](https://bazaar.abuse.ch 'malware bazaar')
to download the malware sample to perfrom static malware analysis.

# Downloading the malware sample
 
 I downloaded the malware sample "c514c22ccbdf3b66a902f2d02b4515920656ac636ce2a4fc683961c25702c59e.zip" from malware bazaar (https://bazaar.abuse.ch/sample/c514c22ccbdf3b66a902f2d02b4515920656ac636ce2a4fc683961c25702c59e/), the sample file is compresed in .zip fromat. I unzip or extract the file using WinRar tool there are also many other tool like 7zip could also be used to extract the .zip files. 

# Finding the malware sample file format

 After extracting the .zip file I found that the malware is it in the .pdf format. to confirm the file format I used HexEditor tool after checking the file in HexEditor I figured out that the file was in .exe format and it hide it by using .pdf format to avoid detection, another thing to consider that the file uses the 
 offset "4D 5A" in HexEditor which also confirm that the file is in .exe format. 

malware sample uses .pdf format after extract the zip file
![Stat Malfa](assets/img/malanalysis/staticmalwfakeform.png)

Finding malware sample format in HexEditor
![Stat Malac](assets/img/malanalysis/statmalactexeform.png)


# Finding the MD5 hash of the malware sample file

After verifying the actual file format I use HashMyFile tool to get the MD5 hash of the file to do further static analysis on the malware sample. the MD5 hash of the file is "ae6112b72845c6a495561783ac5eeffd".

Finding MD5 hash of the file using HashMyFile tool
![Stat Malf](assets/img/malanalysis/MD5hash.png)

# Finding the type and CVE number of the malware sample

After having the MD5 hash of the malware sample I check the MD5 hash of the file in VirusTotal and figureed out that the virus is type of "Smoke Loader" and is flag by 55 vendors that shows that the malware is malicious with CVE of "cve-2014-6345".

Checking the MD5 hash of the malware sample in VirusTotal
![Vir Tot](assets/img/malanalysis/virusTotal.png)


# Smoke Loader malware

It is a type of malware which is use to check the disk space and user input,self delete, and create many .dll files on victim system, it could be spread by using phishing emails in which the victm mistakenly open or run the malware as an attachment and think that the file is in .pdf format but the file actually hides it .exe format.


# Steps to perfrom Dynamic Malware Analysis

To perform the Dynamic Malware analysis the very first step is to setting up the sandbox environment, In this project I alread setup my Windows 10 sandbox environment using VirtualBox tool and perform the dynamic malware analysis using Procmon tool to track and check the behaviour like file explorer, thread activity, and network activity of the same malware sample that I use in Static malware analysis.

# First Stop Windows Security services in Windows Defender

Inside the Windows 10 OS Virtual Machine that we setup for the Dyanmic Analysis, first I stop the MS Windows Security services so that MS Windows Security not flag the malware and stop us to running it inside Windows 10 OS from the Windows 10 search bar type "Windows Security" inside windows security click on "Virus & threat protection" and then under "Virus and threat protection settings" click manage settings and turn off "Real-time protection" and all the other protection services.

Turning off the Windows 10 Security services in Windows defender
![Win Sec](assets/img/malanalysis/winsecoff2.png)

# Steps of using Procmon tool for Dynamic Analysis of a malware sample

Following are the steps to capture the process of the malware sample for Dynamic analysis in Procmon tool.

# 1. Capturing all the running process:

First I opened up the Promon tool and let it capture all the running process from the Windows 10 OS for few minutes and then pause the capturing.

Capturing all the running processess before malware sample execution in Procmon
![Proc Inc](assets/img/malanalysis/iniproccap.png)

# 2. Capturing all the process after running malware sample 

After that I then run the malware executable(.exe) file the same file that I used in Static malware analysis, then start capturing the process again in Procmon tool for 5 more minutes. After that I pause the process capture and start performing my analysis.

Capturing all the process after executing malware sample in Procmon
![Proc fin](assets/img/malanalysis/cretfilmal.png)

# 3. Analysis of File explorer process of malware sample using File explorer filter in Procmon

Using the File Explorer filter in Procmon I found that the malware creates new files and desired access to read from the disk. I also figured out that the malware also create many new threads when using the thread filter in Procom.

Capturing all the File explorer process of Malware sample using File explorer filter in Procmon
![Proc fin](assets/img/malanalysis/cretfilmal.png)

Capturing all the thread process of Malware sample using thread explorer filter in Procmon
![Proc Thr](assets/img/malanalysis/creloadthdll.png)

# 4. Analysis of child processess of the malware sample using Thread process filter in Procmon

Further analysis by filtring the thread process to check for the child processes I found that malware creates a many child process of "WerFault.exe" which is self destruct but the help of process monitor I can able to see those hidden child processes.

Capturing all the child process of Malware sample using thread explorer filter in Procmon
![Proc Ch](assets/img/malanalysis/procchldwerful.png)

# 5. Analysis of Network Activity of the malware sample using Network Activity filter in Procmon

There was no network activity detected by the malware sample when using the Network activity filer which shows that there is no C2 connection were made by the malware, or any remote access to the C2 server.

No Network activity process of Malware sample found using Network activity filter in Procmon
![Proc Net](assets/img/malanalysis/nonetthr.png)


# Conclusion

In this slef independent Malware Analysis project I explained what are Static and Dynamic malware analysis and how to practically perform these analysis using HexEditor, HashMyFile, VirusTotal, and Procmon tools, these tools are also use by SOC and Security Analysts to perform static and dynamic malware analysis. There are also many in-depth dynamic malware analysis process one of them is reverse engineering which could be performed by using tools like Ghidra and Pestudio which is more advance malware analysis process hopefully I would be cover those in my future blogposts. To perform any dynamic malware analysis always use safe sandbox isolated environment. I would also like to share that this project is only use for my educational and learning purposes. hopefully this project helps the viewers who are new to Malware Analysis or anyone in Cybersecurity who would like to learn Malware Analysis.     
















